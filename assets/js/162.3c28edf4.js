(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{693:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"介绍"}},[s._v("介绍")]),s._v(" "),t("p",[s._v("虽然也可以自己写 Shell 实现分发脚本，但由于缺乏运维系统概念，混乱、零碎的写法总是让人难受，一接触到 ansible 就知道很难回去了。")]),s._v(" "),t("p",[s._v("Ansible 是一个用来批量管理部署远程主机上服务的工具，它通过 SSH 协议实现管理节点与远程节点之间的通信，所以首先需要完成 "),t("RouterLink",{attrs:{to:"/os/linux/login-with-rsa-key.html#生成-rsa"}},[s._v("SSH 配置")]),s._v("。")],1),s._v(" "),t("p",[s._v("需要注意的是 Ansible 需要开启公钥认证，也就是添加到 "),t("code",[s._v("known_hosts")]),s._v(" 中，对于大批量的操作可以禁用该行为：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/ansible/ansible.cfg\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改以下内容")]),s._v("\nhost_key_checking "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" False "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消注释")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"install"}},[s._v("install")]),s._v(" "),t("p",[s._v("虽然可以很简单的直接使用 "),t("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#latest-release-via-dnf-or-yum",target:"_blank",rel:"noopener noreferrer"}},[s._v("yum 安装"),t("OutboundLink")],1),s._v("，但由于 ansible 是一个 python 编写的工具，这样就会导致 ansible 依赖于全局的 python，当全局依赖发生变化的时候可能导致 ansible 出现冲突或潜在的安全问题，所以需要隔离 ansible 与其他应用。")]),s._v(" "),t("h3",{attrs:{id:"_1-关闭限制"}},[s._v("1. 关闭限制")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl stop firewalld\nsystemctl disable firewalld\nsystemctl status firewalld "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/sysconfig/selinux\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改以下内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELINUX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("disabled\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reboot")]),s._v("\ngetenforce "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证 Disabled")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"_2-安装-python"}},[s._v("2. 安装 "),t("a",{attrs:{href:"https://www.python.org/downloads/source/",target:"_blank",rel:"noopener noreferrer"}},[s._v("python"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://www.python.org/ftp/python/3.6.9/Python-3.6.9.tar.xz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xf Python-3.6.9.tar.xz\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" Python-3.6.9\n./configure --prefix"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local --with-ensurepip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("install --enable-shared "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LDFLAGS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Wl,-rpath /usr/local/lib"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" altinstall\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" pip3.6\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/bin/pip3.6 /usr/local/bin/pip "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建立软连接")]),s._v("\npip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" virtualenv\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"_3-创建实例"}},[s._v("3. 创建实例")]),s._v(" "),t("p",[s._v("需要创建一个 ansible 用户，并在该系统用户下创建一个 python3.6 版本的 virtualenv 实例。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" deploy\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - deploy\nvirtualenv -p /usr/local/bin/python3.6 .py3-a2.8-env "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建实例")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /home/deploy/.py3-a2.8-env/bin/activate\npip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" paramiko PyYAML  jinja2 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装依赖，保持顺序")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_4-安装-ansible"}},[s._v("4. 安装 ansible")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#latest-release-via-dnf-or-yum",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),t("OutboundLink")],1),s._v("推荐的安装方式，当下载速度极慢时的"),t("RouterLink",{attrs:{to:"/tools/github/download-huge-project-from-github.html"}},[s._v("解决方案")]),s._v("。")],1),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://gitee.com/shanyuhai123/ansible.git\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" ansible .py3-a2.8-env/\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" .py3-a2.8-env/ansible\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" branch -a "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看分支")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout stable-2.8\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /home/deploy/.py3-a2.8-env/ansible/hacking/env-setup -q\nansible --version "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"_5-启用-ansible"}},[s._v("5. 启用 ansible")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v(" -r now "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - deploy\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" .py3-a2.8-env/bin/activate "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载 py3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" .py3-a2.8-env/ansible/hacking/env-setup -q "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载 ansible")]),s._v("\nansible --version "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"inventory"}},[s._v("inventory")]),s._v(" "),t("p",[s._v("Ansible 可同事操作属于一个组的多台主机，组和主机之间的关系通过 "),t("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("inventory"),t("OutboundLink")],1),s._v(" 文件配置。默认的文件路径为 "),t("code",[s._v("/etc/ansible/hosts")]),s._v("，除默认文件外，还可以使用多个 inventory 文件，当然也可以从云上拉取配置信息。")]),s._v(" "),t("h3",{attrs:{id:"_1-ini-like"}},[s._v("1. INI-like")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mail.example.com\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.11\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.12\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nwww"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("01:50"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".example.com\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndb-"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("a:f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".example.com\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webservers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nfoo.example.com\nbar.example.com\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dbservers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\none.example.com\ntwo.example.com\nthree.example.com:5309\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h3",{attrs:{id:"_2-yaml"}},[s._v("2. YAML")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.example.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("children")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("webservers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo.example.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bar.example.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dbservers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("one.example.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("two.example.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("three.example.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h3",{attrs:{id:"_3-inheriting-variable-values"}},[s._v("3. Inheriting variable values")]),s._v(" "),t("p",[s._v("在这种情况下自己书写规则 INI-like 风格更方便一些，但是接手他人的时候更希望看到 YAML 风格，更一目了然。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("INI-like")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("atlanta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhost1\nhost2\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("raleigh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhost2\nhost3\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("southeast:children"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\natlanta\nraleigh\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("southeast:vars"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("some_server")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("foo.southeast.example.com\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("halon_system_timeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("self_destruct_countdown")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("escape_pods")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("usa:children"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nsoutheast\nnortheast\nsouthwest\nnorthwest\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("YAML")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("children")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("usa")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("children")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("southeast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("children")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("atlanta")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("raleigh")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("vars")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("some_server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" foo.southeast.example.com\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("halon_system_timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("self_destruct_countdown")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("escape_pods")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("northeast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("northwest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("southwest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"_4-参数"}},[s._v("4. 参数")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("参数")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_connection")]),s._v(" "),t("td",[s._v("连接类型到主机。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_host")]),s._v(" "),t("td",[s._v("要连接的主机的名称。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_port")]),s._v(" "),t("td",[s._v("连接端口号。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_user")]),s._v(" "),t("td",[s._v("连接到主机时要使用的用户名。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_password")]),s._v(" "),t("td",[s._v("身份验证的密码。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_ssh_private_key_file")]),s._v(" "),t("td",[s._v("ssh使用的私钥文件。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_ssh_common_args")]),s._v(" "),t("td",[s._v("此设置始终附加到sftp，scp和ssh的默认命令行。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_sftp_extra_args")]),s._v(" "),t("td",[s._v("此设置始终附加到默认的sftp命令行。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_scp_extra_args")]),s._v(" "),t("td",[s._v("此设置始终附加到默认scp命令行。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_ssh_extra_args")]),s._v(" "),t("td",[s._v("此设置始终附加到默认的ssh命令行。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_ssh_pipelining")]),s._v(" "),t("td",[s._v("确定是否使用SSH流水线。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_ssh_executable")]),s._v(" "),t("td",[s._v("此设置将覆盖使用系统ssh的默认行为。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_shell_type")]),s._v(" "),t("td",[s._v("目标系统的shell类型。")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("ansible_python_interpreter")]),s._v(" "),t("td",[s._v("目标主机python路径。")])])])]),s._v(" "),t("h2",{attrs:{id:"ad-hoc"}},[s._v("ad-hoc")]),s._v(" "),t("p",[s._v("ad-hoc 可以帮助完成临时任务，很多时候并不需要 Ansible 的强大力量（playbook）。")]),s._v(" "),t("p",[s._v("命令格式：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ansible "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pattern_goes_here"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -m "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("module_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("arguments"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("仅列出部分示例。")]),s._v(" "),t("h3",{attrs:{id:"_1-command"}},[s._v("1. "),t("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/command_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("command"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("Execute "),t("strong",[s._v("command")]),s._v("s on targets。")]),s._v(" "),t("p",[s._v("实践：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ansible t1 -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"free -m"')]),s._v("\nansible t1 -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"df -h"')]),s._v("\nansible t1 -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ls /root"')]),s._v("\nansible t1 -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cat redhat-release"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_2-shell"}},[s._v("2. "),t("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/shell_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("shell"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("Execute shell commands on targets。")]),s._v(" "),t("p",[s._v("实践：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ansible t1 -m shell -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo hello > /tmp/tmp.txt"')]),s._v("\nansible t1 -m shell -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cat /tmp/tmp.txt"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_3-copy"}},[s._v("3. "),t("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/copy_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("copy"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("Copy files to remote locations。")]),s._v(" "),t("p",[s._v("实践：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ansible t1 -m copy -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src=/root/shell dest=/tmp"')]),s._v("\nansible t1 -m shell -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ls /tmp"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\nansible t1 -m shell -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wc -l /tmp/shell"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_4-script"}},[s._v("4. "),t("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/script_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("script"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("Runs a local script on a remote node after transferring it。")]),s._v(" "),t("p",[s._v("实践：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo hello"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /tmp/hello.sh\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /tmp/hello.sh "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\nansible t1 -m script -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/tmp/hello.sh"')]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_5-file"}},[s._v("5. "),t("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/file_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("file"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("Manage files and file properties。")]),s._v(" "),t("h3",{attrs:{id:"_6-yum"}},[s._v("6. "),t("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/yum_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("yum"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("Manages packages with the yum package manager。")]),s._v(" "),t("p",[s._v("实践：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ansible webservers -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"free -m"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n\nansible webservers -m yum -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=nginx state=installed"')]),s._v("\nansible webservers -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -v"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证 nginx version: nginx/1.12.2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以注意到并非是最新版 nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 参照示例 https://docs.shanyuhai.top/os/centos/install-the-latest-version-of-nginx.html")]),s._v("\nansible webservers -m yum -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=yum-utils state=installed"')]),s._v("\nansible webservers -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ll /etc/yum.repos.d/nginx.repo"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/yum.repos.d/nginx.repo\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/yum.repos.d/nginx.repo "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 追加内容参考示例")]),s._v("\nansible webservers -m copy -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src=/etc/yum.repos.d/nginx.repo dest=/etc/yum.repos.d/nginx.repo"')]),s._v("\nansible webservers -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cat /etc/yum.repos.d/nginx.repo"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\nansible webservers -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yum-config-manager --enable nginx-mainline"')]),s._v("\nansible webservers -m yum -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=nginx state=installed"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# installed 测试时未能更新，可能需要 present 参数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不推荐使用 yum 卸载")]),s._v("\nansible webservers -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -v"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证 ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h3",{attrs:{id:"_7-systemd"}},[s._v("7. "),t("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/systemd_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("systemd"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("Manage services。")]),s._v(" "),t("p",[s._v("实践：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最好将服务写完整")]),s._v("\nansible t1 -m systemd -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=crond.service  enabled=yes state=started"')]),s._v("\nansible t1 -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemctl status crond"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_8-cron"}},[s._v("8. "),t("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/cron_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("cron"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("Manage cron.d and crontab entries。")]),s._v(" "),t("p",[s._v("实践：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ansible webservers -m "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cron")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"name='sync time' minute=00 hour=00 job='/usr/sbin/ntpdate time.nist.gov > /dev/null 2>&1'\"")]),s._v(" \nansible webservers -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"crontab -l"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除任务")]),s._v("\nansible webservers -m "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cron")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"name='sync time' state=absent\"")]),s._v(" \nansible webservers -m "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"crontab -l"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"playbooks"}},[s._v("playbooks")]),s._v(" "),t("p",[s._v("相对于 ad-hoc，playbooks 则强大的多，当然也复杂得多。playbook 由一个或多个 plays 组成，在 play 中，一组机器被映射为定义好的角色，其内容被称为 tasks（任务），在基本层次的应用中，一个任务是一个对 ansible 模块的调用。")]),s._v(" "),t("p",[s._v("对于如何良好的实践这些内容，有一些整套的 "),t("a",{attrs:{href:"https://github.com/ansible/ansible-examples",target:"_blank",rel:"noopener noreferrer"}},[s._v("playbooks"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"_1-one-play"}},[s._v("1. one play")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" webservers\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("vars")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http_port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_clients")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ensure apache is at the latest version\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpd\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" latest\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" write the apache config file\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /srv/httpd.j2\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/httpd.conf\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notify")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" restart apache\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ensure apache is running\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpd\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" started\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("handlers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restart apache\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpd\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restarted\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h3",{attrs:{id:"_2-multiple-plays"}},[s._v("2. multiple plays")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" webservers\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ensure apache is at the latest version\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpd\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" latest\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" write the apache config file\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /srv/httpd.j2\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/httpd.conf\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" databases\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ensure postgresql is at the latest version\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" postgresql\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" latest\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ensure that postgresql is started\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" postgresql\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" started\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h3",{attrs:{id:"_3-directory-layout"}},[s._v("3. Directory Layout")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("production                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# inventory file for production servers")]),s._v("\nstaging                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# inventory file for staging environment")]),s._v("\n\ngroup_vars/\n   group1.yml             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# here we assign variables to particular groups")]),s._v("\n   group2.yml\nhost_vars/\n   hostname1.yml          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# here we assign variables to particular systems")]),s._v("\n   hostname2.yml\n\nlibrary/                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if any custom modules, put them here (optional)")]),s._v("\nmodule_utils/             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if any custom module_utils to support modules, put them here (optional)")]),s._v("\nfilter_plugins/           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if any custom filter plugins, put them here (optional)")]),s._v("\n\nsite.yml                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# master playbook")]),s._v("\nwebservers.yml            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# playbook for webserver tier")]),s._v("\ndbservers.yml             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# playbook for dbserver tier")]),s._v("\n\nroles/\n    common/               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# this hierarchy represents a "role"')]),s._v("\n        tasks/            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n            main.yml      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  <-- tasks file can include smaller files if warranted")]),s._v("\n        handlers/         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n            main.yml      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  <-- handlers file")]),s._v("\n        templates/        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  <-- files for use with the template resource")]),s._v("\n            ntp.conf.j2   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  <------- templates end in .j2")]),s._v("\n        files/            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n            bar.txt       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  <-- files for use with the copy resource")]),s._v("\n            foo.sh        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  <-- script files for use with the script resource")]),s._v("\n        vars/             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n            main.yml      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  <-- variables associated with this role")]),s._v("\n        defaults/         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n            main.yml      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  <-- default lower priority variables for this role")]),s._v("\n        meta/             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n            main.yml      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  <-- role dependencies")]),s._v("\n        library/          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# roles can also include custom modules")]),s._v("\n        module_utils/     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# roles can also include custom module_utils")]),s._v("\n        lookup_plugins/   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or other types of plugins, like lookup in this case")]),s._v("\n\n    webtier/              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# same kind of structure as "common" was above, done for the webtier role')]),s._v("\n    monitoring/           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ""')]),s._v("\n    fooapp/               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ""')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br")])]),t("p",[s._v("备用方案：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("inventories/\n   production/\n      hosts               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# inventory file for production servers")]),s._v("\n      group_vars/\n         group1.yml       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# here we assign variables to particular groups")]),s._v("\n         group2.yml\n      host_vars/\n         hostname1.yml    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# here we assign variables to particular systems")]),s._v("\n         hostname2.yml\n\n   staging/\n      hosts               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# inventory file for staging environment")]),s._v("\n      group_vars/\n         group1.yml       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# here we assign variables to particular groups")]),s._v("\n         group2.yml\n      host_vars/\n         stagehost1.yml   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# here we assign variables to particular systems")]),s._v("\n         stagehost2.yml\n\nlibrary/\nmodule_utils/\nfilter_plugins/\n\nsite.yml\nwebservers.yml\ndbservers.yml\n\nroles/\n    common/\n    webtier/\n    monitoring/\n    fooapp/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);