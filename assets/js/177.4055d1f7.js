(window.webpackJsonp=window.webpackJsonp||[]).push([[177],{708:function(v,_,e){"use strict";e.r(_);var t=e(2),l=Object(t.a)({},(function(){var v=this,_=v.$createElement,e=v._self._c||_;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("p",[v._v("该项仅在虚拟机下进行测试，与实体机有一定区别。")]),v._v(" "),e("h2",{attrs:{id:"准备环境"}},[v._v("准备环境")]),v._v(" "),e("ul",[e("li",[v._v("虚拟机：VirtualBox（6.0.10）")])]),v._v(" "),e("h2",{attrs:{id:"新增磁盘工作"}},[v._v("新增磁盘工作")]),v._v(" "),e("p",[v._v("事情的开始你需要有一块磁盘。")]),v._v(" "),e("h3",{attrs:{id:"_1-操作步骤"}},[v._v("1. 操作步骤")]),v._v(" "),e("ol",[e("li",[v._v("打开虚拟机；")]),v._v(" "),e("li",[v._v("在界面中点击设置并选中存储；")]),v._v(" "),e("li",[v._v("可以选择已有的控制器也可以新建控制器，点击添加存储附件（虚拟硬盘）；")]),v._v(" "),e("li",[v._v("控制器选项有 SAS、SATA、IDE（古老的存在，现在很少用了），控制器即对应不同类型的硬盘；")]),v._v(" "),e("li",[v._v("创建新的虚拟盘，默认 VDI 文件类型，动态分配；")]),v._v(" "),e("li",[v._v("分配期望的大小；")]),v._v(" "),e("li",[v._v("确认创建。")])]),v._v(" "),e("h2",{attrs:{id:"磁盘进行-raid"}},[v._v("磁盘进行 RAID")]),v._v(" "),e("p",[v._v("为了数据更安全，更快捷，需要进行 "),e("a",{attrs:{href:"/os/linux/raid"}},[v._v("RAID")]),v._v("。")]),v._v(" "),e("p",[v._v("此处缺乏 RAID 实践，以后可能会补上，参考资料：")]),v._v(" "),e("ol",[e("li",[e("a",{attrs:{href:"http://www.iyunwei.com/docs/sysadmin_command/CentOS6.3%E4%B8%8B%E9%85%8D%E7%BD%AE%E8%BD%AFRAID.pdf",target:"_blank",rel:"noopener noreferrer"}},[v._v("CentOS 6.3 下配置软 RAID"),e("OutboundLink")],1),v._v("；")]),v._v(" "),e("li",[e("a",{attrs:{href:"https://www.intel.cn/content/www/cn/zh/support/articles/000006748/boards-and-kits/desktop-boards.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("Intel 主板中 BIOS 中启用 RAID"),e("OutboundLink")],1),v._v("；")])]),v._v(" "),e("p",[v._v("需要补充的是，虽然很多资料都说明硬件 RAID 更具优势，但是在现在高速 Nvme 硬盘的情况下是否依然效率更高呢 👦？")]),v._v(" "),e("h2",{attrs:{id:"磁盘分区工作"}},[v._v("磁盘分区工作")]),v._v(" "),e("p",[v._v("磁盘是按柱面进行分区的，磁盘分区信息登记的地点为"),e("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E4%B8%BB%E5%BC%95%E5%AF%BC%E8%AE%B0%E5%BD%95",target:"_blank",rel:"noopener noreferrer"}},[v._v("磁盘分区表"),e("OutboundLink")],1),v._v("，磁盘分区表存放位置为 0 磁道 0 柱面 1 扇区。")]),v._v(" "),e("p",[v._v("该扇区（1 扇区）划分为，前 446 字节为系统引导信息，中间 64 字节为分区表，后 2 字节为分区结束标识。")]),v._v(" "),e("p",[v._v("修改磁盘分区常用工具为：")]),v._v(" "),e("ul",[e("li",[v._v("fdisk：处理 MBR 分区，MBR 分区小于 2T；")]),v._v(" "),e("li",[v._v("parted：处理 GPT 分区，GPT 分区大于 2T。")])]),v._v(" "),e("h3",{attrs:{id:"_1-操作步骤-2"}},[v._v("1. 操作步骤")]),v._v(" "),e("ol",[e("li",[v._v("首先添加一块虚拟硬盘到系统中；")]),v._v(" "),e("li",[v._v("使用 "),e("code",[v._v("fdisk -l")]),v._v(" 获取新增硬盘的信息；")]),v._v(" "),e("li",[v._v("确认以 "),e("code",[v._v("3P+1E(3L)")]),v._v(" 分区为示例；")]),v._v(" "),e("li",[v._v("根据新增硬盘信息输入 "),e("code",[v._v("fdisk /dev/sdb")]),v._v("；")]),v._v(" "),e("li",[v._v("可以输入 "),e("code",[v._v("m")]),v._v(" 查看帮助；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("n")]),v._v(" 新增分区；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("p")]),v._v(" 选择主分区；")]),v._v(" "),e("li",[v._v("分区 number，default 为 1，回车即可；")]),v._v(" "),e("li",[v._v("first sector，default 2048，回车即可；")]),v._v(" "),e("li",[v._v("last sector，设置 1G 大小，即输入 "),e("code",[v._v("+1G")]),v._v("；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("p")]),v._v(" 查看结果，确认无误后继续；")]),v._v(" "),e("li",[v._v("循环上面的步骤，开始第二个主分区；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("n")]),v._v(" 新增分区；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("p")]),v._v(" 选择主分区；")]),v._v(" "),e("li",[v._v("分区 number，default 为 2，回车即可；")]),v._v(" "),e("li",[v._v("first sector，default 2099200，回车即可；")]),v._v(" "),e("li",[v._v("last sector，设置 1G 大小，即输入 "),e("code",[v._v("+1G")]),v._v("；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("p")]),v._v(" 查看结果，确认无误后继续；")]),v._v(" "),e("li",[v._v("循环上面的步骤，开始第三个主分区；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("n")]),v._v(" 新增分区；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("p")]),v._v(" 选择主分区；")]),v._v(" "),e("li",[v._v("分区 number，default 为 3，回车即可；")]),v._v(" "),e("li",[v._v("first sector，default 4196352，回车即可；")]),v._v(" "),e("li",[v._v("last sector，设置 1G 大小，即输入 "),e("code",[v._v("+1G")]),v._v("；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("p")]),v._v(" 查看结果，确认无误后继续；")]),v._v(" "),e("li",[v._v("循环上面的步骤，开始扩展分区；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("n")]),v._v(" 新增分区；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("e")]),v._v(" 选择主分区；")]),v._v(" "),e("li",[v._v("first sector，default 6293504，回车即可；")]),v._v(" "),e("li",[v._v("last sector，default 12582911，回车选择剩余所有空间即可；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("p")]),v._v(" 查看结果，确认无误后继续；")]),v._v(" "),e("li",[v._v("接下来在扩展分区中新建逻辑分区；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("n")]),v._v(" 新增分区；")]),v._v(" "),e("li",[v._v("first sector，default 6293504，回车即可；")]),v._v(" "),e("li",[v._v("last sector，设置 1G 大小，即输入 "),e("code",[v._v("+1G")]),v._v("；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("p")]),v._v(" 查看结果，确认无误后继续；")]),v._v(" "),e("li",[v._v("循环上面的步骤，开始第二个逻辑分区；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("n")]),v._v(" 新增分区；")]),v._v(" "),e("li",[v._v("first sector，default 6293504，回车即可；")]),v._v(" "),e("li",[v._v("last sector，设置 1G 大小，即输入 "),e("code",[v._v("+1G")]),v._v("；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("p")]),v._v(" 查看结果，确认无误后继续；")]),v._v(" "),e("li",[v._v("循环上面的步骤，开始第三个逻辑分区；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("n")]),v._v(" 新增分区；")]),v._v(" "),e("li",[v._v("first sector，default 6293504，回车即可；")]),v._v(" "),e("li",[v._v("last sector，default 12582911，回车选择剩余所有空间即可；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("p")]),v._v(" 查看结果，确认无误后继续；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("w")]),v._v(" 保存分区结果；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("partprobe /dev/sdb")]),v._v(" 通知分区信息修改了，或者重启虚拟机。")])]),v._v(" "),e("h2",{attrs:{id:"磁盘分区类型"}},[v._v("磁盘分区类型")]),v._v(" "),e("p",[v._v("磁盘的分区类型往往决定该分区具体的作用。")]),v._v(" "),e("h3",{attrs:{id:"_1-操作步骤-3"}},[v._v("1. 操作步骤")]),v._v(" "),e("ol",[e("li",[v._v("使用 "),e("code",[v._v("fdisk -l")]),v._v(" 获取新增硬盘的信息；")]),v._v(" "),e("li",[v._v("根据硬盘信息选择 "),e("code",[v._v("fdisk /dev/sdb")]),v._v("；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("m")]),v._v(" 查看帮助；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("l")]),v._v(" 查看分区类型；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("t")]),v._v(" 修改分区 system Id；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("7")]),v._v(" 选择第七个分区；")]),v._v(" "),e("li",[v._v("根据提示输入 "),e("code",[v._v("L")]),v._v(" 查看 codes；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("8e")]),v._v("；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("p")]),v._v(" 查看结果，确认无误后继续；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("w")]),v._v(" 保存分区结果；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("partprobe /dev/sdb")]),v._v(" 通知分区信息修改了，或者重启虚拟机。")])]),v._v(" "),e("h2",{attrs:{id:"分区文件系统"}},[v._v("分区文件系统")]),v._v(" "),e("p",[v._v("磁盘需要借助"),e("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F",target:"_blank",rel:"noopener noreferrer"}},[v._v("文件系统"),e("OutboundLink")],1),v._v("才能实现磁盘管理，"),e("a",{attrs:{href:"/computer/data-write"}},[v._v("数据存取")]),v._v("。")]),v._v(" "),e("h3",{attrs:{id:"_1-操作步骤-4"}},[v._v("1. 操作步骤")]),v._v(" "),e("ol",[e("li",[v._v("使用 "),e("code",[v._v("fdisk -l")]),v._v(" 获取新增硬盘的信息；")]),v._v(" "),e("li",[v._v("根据硬盘信息选择 "),e("code",[v._v("fdisk /dev/sdb")]),v._v("；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("mkfs -t ext4 /dev/sdb1")]),v._v(" 来创建 ext4 文件系统；")]),v._v(" "),e("li",[v._v("或输入 "),e("code",[v._v("mkfs.xfs /dev/sdb2")]),v._v(" 来创建 xfs 文件系统；")]),v._v(" "),e("li",[v._v("查看输入，可以观察到生成了一定数量的 inodes 和 blocks，这是关键所在。")])]),v._v(" "),e("blockquote",[e("p",[v._v("inode 作用，存储文件的属性信息，同时存放指向文件实体的指针。")]),v._v(" "),e("p",[v._v("当存放文件提示：no space left on device，可能是 inodes 数量满了。")]),v._v(" "),e("p",[v._v("排查二连："),e("code",[v._v("df -h")]),v._v("，"),e("code",[v._v("df -i")]),v._v("。")])]),v._v(" "),e("h2",{attrs:{id:"挂载磁盘分区"}},[v._v("挂载磁盘分区")]),v._v(" "),e("p",[v._v("挂载分区前需要完成以上工作。")]),v._v(" "),e("p",[v._v("挂载分区分为临时挂载和永久挂载。")]),v._v(" "),e("h3",{attrs:{id:"_1-临时挂载分区操作步骤"}},[v._v("1. 临时挂载分区操作步骤")]),v._v(" "),e("ol",[e("li",[v._v("输入 "),e("code",[v._v("mount -t ext4 /dev/sdb1 /mnt")]),v._v("；")]),v._v(" "),e("li",[v._v("创建文件测试 "),e("code",[v._v("echo hello > /mnt/hello.txt")]),v._v("；")]),v._v(" "),e("li",[v._v("验证 "),e("code",[v._v("cat /mnt/hello.txt")]),v._v("；")]),v._v(" "),e("li",[v._v("查看挂载结果 "),e("code",[v._v("cat /proc/mounts")]),v._v("；")]),v._v(" "),e("li",[v._v("卸载 "),e("code",[v._v("umount /mnt")]),v._v("。")])]),v._v(" "),e("h3",{attrs:{id:"_2-永久挂载分区操作步骤"}},[v._v("2. 永久挂载分区操作步骤")]),v._v(" "),e("ol",[e("li",[v._v("永久实际上是开机自动挂载；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("cat /etc/fstab")]),v._v(" 查看输入格式；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("blkid")]),v._v(" 查看 /dev/sdb2 的 UUID；")]),v._v(" "),e("li",[v._v("编辑 "),e("code",[v._v("/etc/fstab")]),v._v("；")]),v._v(" "),e("li",[v._v("追加 "),e("code",[v._v("UUID=8c0514b8-70a9-4389-a17c-823e55ff8789 /mnt xfs defaults 0 0")]),v._v("；")]),v._v(" "),e("li",[v._v("或使用分区也可 "),e("code",[v._v("/dev/sdb2 /mnt xfs defaults 0 0")]),v._v("；")]),v._v(" "),e("li",[v._v("重启输入 "),e("code",[v._v("cat /proc/mounts")]),v._v(" 或 "),e("code",[v._v("df -h")]),v._v(" 挂载结果。")])]),v._v(" "),e("h2",{attrs:{id:"补充-扩展-swap"}},[v._v("补充：扩展 swap")]),v._v(" "),e("p",[v._v("发现 swap 早期分配的太小了不够用可以追加。")]),v._v(" "),e("h3",{attrs:{id:"_1-操作步骤-5"}},[v._v("1. 操作步骤")]),v._v(" "),e("ol",[e("li",[v._v("输入 "),e("code",[v._v("free -m")]),v._v(" 查看 swap 大小；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("fdisk -l")]),v._v(" 查看可用的分区；")]),v._v(" "),e("li",[v._v("无可用分区就按照 "),e("RouterLink",{attrs:{to:"/os/linux/how-to-enable-the-hard-disk.html#磁盘分区工作"}},[v._v("磁盘分区工作")]),v._v(" 新建一个分区；")],1),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("mkswap /dev/sdb3")]),v._v(" 格式化分区为 swap；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("swapon -a /dev/sdb3")]),v._v(" 启用 swap 分区；")]),v._v(" "),e("li",[v._v("输入 "),e("code",[v._v("free -m")]),v._v(" 验证结果。")])])])}),[],!1,null,null,null);_.default=l.exports}}]);