(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{552:function(s,a,n){"use strict";n.r(a);var e=n(2),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"环境"}},[s._v("环境")]),s._v(" "),n("p",[s._v("创建一台虚拟机为私有仓库，本机向虚拟机的仓库发起上传和下载。")]),s._v(" "),n("h2",{attrs:{id:"搭建仓库"}},[s._v("搭建仓库")]),s._v(" "),n("p",[s._v("在虚拟机上创建仓库，并指定镜像文件存放在本地的默认路径，为其设置 docker 重启后跟随重启。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker run -d --restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always --name registry -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 -v /opt/data/registry:/var/lib/registry registry\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("后续的 "),n("code",[s._v("registry")]),s._v(" 配置可见 "),n("code",[s._v("/etc/docker/registry/config.yml")]),s._v("。")]),s._v(" "),n("h2",{attrs:{id:"主机测试"}},[s._v("主机测试")]),s._v(" "),n("p",[s._v("Docker 新的版本对安全性要求较高，要求仓库支持 SSL/TLS 证书，可以在本地信任该仓库。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/docker/daemon.json\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 JSON 中追加内容，对应的 IP 地址")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.107:5000"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart docker\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("主机上传镜像到虚拟机仓库验证。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker pull ubuntu\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打 tag")]),s._v("\ndocker tag ubuntu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.107:5000/tubuntu\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# push")]),s._v("\ndocker push "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.107:5000/tubuntu\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.0.107:5000/v2/_catalog\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# {"repositories":["tubuntu"]} # 成功')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 还可以直接打开上面链接进行查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者在虚拟机上查看 ll /opt/data/registry/docker/registry/v2/repositories")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("下载验证。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 首先删除本地的镜像")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.107:5000/tubuntu\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\ndocker images\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取")]),s._v("\ndocker pull "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.107:5000/tubuntu\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\ndocker images\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"harbor"}},[s._v("Harbor")]),s._v(" "),n("p",[s._v("另外一个选择是使用 "),n("a",{attrs:{href:"https://github.com/goharbor/harbor",target:"_blank",rel:"noopener noreferrer"}},[s._v("Harbor"),n("OutboundLink")],1),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"_1-获取-harbor"}},[s._v("1. 获取 Harbor")]),s._v(" "),n("p",[s._v("先下载文件。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目标压缩包")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/goharbor/harbor/releases/download/v2.0.5/harbor-offline-installer-v2.0.5.tgz\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gpg")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/goharbor/harbor/releases/download/v2.0.5/harbor-offline-installer-v2.0.5.tgz.asc\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("获取文件后先校验有没有问题：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 校验")]),s._v("\ngpg --verify harbor-offline-installer-v2.0.5.tgz.asc harbor-offline-installer-v2.0.5.tgz\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gpg: using RSA key 7722D168DAEC457806C96FF9644FF454C0B4115C")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# gpg: Can't check signature: No public key")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入公钥")]),s._v("\ngpg --keyserver hkps://keyserver.ubuntu.com --receive-keys 7722D168DAEC457806C96FF9644FF454C0B4115C\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次校验")]),s._v("\ngpg --verify harbor-offline-installer-v2.0.5.tgz.asc harbor-offline-installer-v2.0.5.tgz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"_2-安装"}},[s._v("2. 安装")]),s._v(" "),n("p",[s._v("先进行解压：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xvf harbor-offline-installer-v2.0.5.tgz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("修改配置文件：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" harbor.yml.tmpl harbor.yml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" harbor.yml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("其中 "),n("code",[s._v("data_volume")]),s._v(" 挂载数据。")]),s._v(" "),n("p",[s._v("在安装前需要确认已经准备好 "),n("code",[s._v("docker")]),s._v(" 及 "),n("code",[s._v("docker-compose")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" install.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_3-重装"}},[s._v("3. 重装")]),s._v(" "),n("p",[s._v("当修改配置后运行 "),n("code",[s._v("bash prepare")]),s._v(" 即可。")]),s._v(" "),n("h3",{attrs:{id:"_4-用户"}},[s._v("4. 用户")]),s._v(" "),n("p",[s._v("Harbor 使用前需要注册帐号，推送镜像前需要先创建项目，邀请成员才行。")]),s._v(" "),n("h2",{attrs:{id:"自签证书"}},[s._v("自签证书")]),s._v(" "),n("p",[s._v("Harbor 在非 "),n("code",[s._v("https")]),s._v(" 的环境下总是会出现各种各样的问题，而内网使用时需要自签证书解决 "),n("code",[s._v("https")]),s._v(" 问题。")]),s._v(" "),n("p",[s._v("Harbor 官网对这一部分有详细的"),n("a",{attrs:{href:"https://goharbor.io/docs/2.1.0/install-config/configure-https/",target:"_blank",rel:"noopener noreferrer"}},[s._v("说明"),n("OutboundLink")],1),s._v("，此处稍微简化。")]),s._v(" "),n("h3",{attrs:{id:"_1-生成-ca-证书"}},[s._v("1. 生成 CA 证书")]),s._v(" "),n("p",[s._v("先生成 "),n("code",[s._v("ca")]),s._v(" 私钥：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("openssl genrsa -out ca.key "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("再生成 "),n("code",[s._v("ca")]),s._v(" 证书：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("openssl req -x509 -new -nodes -sha512 -days "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3650")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -subj "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=harbor.xxx.com"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -key ca.key "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -out ca.crt\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"_2-生成服务端证书"}},[s._v("2. 生成服务端证书")]),s._v(" "),n("p",[s._v("服务端证书包含 "),n("code",[s._v(".crt")]),s._v(" 及 "),n("code",[s._v(".key")]),s._v(" 文件。")]),s._v(" "),n("p",[s._v("先生成域名私钥：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("openssl genrsa -out harbor.xxx.com.key "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("再生成证书签名请求（Certificate Signing Request）：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("openssl req -sha512 -new "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -subj "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=harbor.xxx.com"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -key harbor.xxx.com.key "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -out harbor.xxx.com.csr\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("再生成 "),n("code",[s._v("x509 v3")]),s._v(" 扩展：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" v3.ext "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1=harbor.xxx.com\nDNS.2=xxx\nDNS.3=hostname\nEOF")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("根据 "),n("code",[s._v("v3.ext")]),s._v(" 生成证书：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("openssl x509 -req -sha512 -days "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3650")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -extfile v3.ext "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -CA ca.crt -CAkey ca.key -CAcreateserial "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -in harbor.xxx.com.csr "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -out harbor.xxx.com.crt\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("将 "),n("code",[s._v("crt")]),s._v(" 转为 "),n("code",[s._v("cert")]),s._v("，以供 Docker client 使用：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("openssl x509 -inform PEM -in harbor.xxx.com.crt -out harbor.xxx.com.cert\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_3-docker-客户端使用"}},[s._v("3. Docker 客户端使用")]),s._v(" "),n("p",[s._v("需要将证书拷贝至 "),n("code",[s._v("docker")]),s._v(" 配置即"),n("code",[s._v("/etc/docker/certs.d/harbor.xxx.com/")]),s._v(" 目录下，增加 "),n("code",[s._v("ca.crt")]),s._v(" 、"),n("code",[s._v("harbor.xxx.com.cert")]),s._v(" 、"),n("code",[s._v("harbor.xxx.com.key")]),s._v(" 三个文件，最后结构如下：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("/etc/docker/certs.d/\n    └── harbor.xxx.com\n       ├── harbor.xxx.com.cert\n       ├── harbor.xxx.com.key\n       └── ca.crt\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("配置完成后还需重启 Docker。")]),s._v(" "),n("h3",{attrs:{id:"_4-浏览器使用"}},[s._v("4. 浏览器使用")]),s._v(" "),n("p",[s._v("Manjaro 下找到 SSL 设置，添加 "),n("code",[s._v("harbor.xxx.com.crt")]),s._v(" 证书即可。")]),s._v(" "),n("h3",{attrs:{id:"_5-注意事项"}},[s._v("5. 注意事项")]),s._v(" "),n("p",[s._v("在使用 Nginx 反向代理 "),n("code",[s._v("push")]),s._v(" 存在"),n("a",{attrs:{href:"https://github.com/goharbor/harbor/issues/13553",target:"_blank",rel:"noopener noreferrer"}},[s._v("问题"),n("OutboundLink")],1),s._v("。根据 "),n("code",[s._v("common/config/nginx/nginx.conf")]),s._v(" 中的提示注释，需注意不止一处：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# When setting up Harbor behind other proxy, such as an Nginx instance, remove the below line if the proxy already has similar settings.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#proxy_set_header X-Forwarded-Proto $scheme;")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);