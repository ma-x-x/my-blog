(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{704:function(s,t,a){"use strict";a.r(t);var e=a(2),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"介绍"}},[s._v("介绍")]),s._v(" "),a("p",[s._v('firewalld 是 CentOS 7 新增的特性，其支持动态更新，且添加了防火墙 "zones" 的概念。')]),s._v(" "),a("p",[s._v("firewalld 与 iptables 自身并不具备防火墙的功能，都需要通过内核的 netfilter 来实现，它们的作用都是维护过滤的规则。")]),s._v(" "),a("p",[s._v("firewalld 的配置文件存放在 "),a("code",[s._v("/usr/lib/firewalld/")]),s._v(" 和 "),a("code",[s._v("/etc/firewalld/")]),s._v(" 里的 XML 文件中。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" firewalld firewall-config\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"指令"}},[s._v("指令")]),s._v(" "),a("blockquote",[a("p",[s._v("可能需要先使用 systemctl 套件启用服务。")]),s._v(" "),a("p",[s._v("除了使用命令格式外，还可以使用 GUI，不过需要注意的是在登录时需要 "),a("code",[s._v("ssh -Y user@ip")]),s._v(" 。")])]),s._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"title"}),a("p",[s._v("firewall-cmd [Options ... ]")])]),a("h3",{attrs:{id:"_1-状态选项"}},[s._v("1. 状态选项")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("option")]),s._v(" "),a("th",[s._v("effect")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("--state")]),s._v(" "),a("td",[s._v("firewalld 的状态。")])]),s._v(" "),a("tr",[a("td",[s._v("--reload")]),s._v(" "),a("td",[s._v("不中断服务的重新加载。")])]),s._v(" "),a("tr",[a("td",[s._v("--complete-reload")]),s._v(" "),a("td",[s._v("中断所有连接的重新加载。")])]),s._v(" "),a("tr",[a("td",[s._v("--runtime-to-permanent")]),s._v(" "),a("td",[s._v("将当前防火墙的规则永久保存。")])]),s._v(" "),a("tr",[a("td",[s._v("--check-config")]),s._v(" "),a("td",[s._v("检查配置正确性。")])])])]),s._v(" "),a("h3",{attrs:{id:"_2-日志选项"}},[s._v("2. 日志选项")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("option")]),s._v(" "),a("th",[s._v("effect")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("--get-log-denied")]),s._v(" "),a("td",[s._v("获取记录被拒绝的日志。")])]),s._v(" "),a("tr",[a("td",[s._v("--set-log-denied="),a("value")],1),s._v(" "),a("td",[s._v("设置记录被拒绝的日志，只能为 'all','unicast','broadcast','multicast','off' 其中的一个。")])])])]),s._v(" "),a("h2",{attrs:{id:"操作"}},[s._v("操作")]),s._v(" "),a("p",[s._v("在开始操作前需要对 zone 有一定的了解。")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("zone")]),s._v(" "),a("th",[s._v("zh")]),s._v(" "),a("th",[s._v("effect")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("drop")]),s._v(" "),a("td",[s._v("丢弃")]),s._v(" "),a("td",[s._v("任何接收的网络数据包都被丢弃，没有任何回复。仅能有发送出去的网络连接。")])]),s._v(" "),a("tr",[a("td",[s._v("block")]),s._v(" "),a("td",[s._v("限制")]),s._v(" "),a("td",[s._v("任何接收的网络连接都被 "),a("code",[s._v("IPv4")]),s._v(" 的 icmp-host-prohibited 信息和 "),a("code",[s._v("IPv6")]),s._v(" 的 icmp6-adm-prohibited 信息所拒绝。")])]),s._v(" "),a("tr",[a("td",[s._v("public")]),s._v(" "),a("td",[s._v("公共")]),s._v(" "),a("td",[s._v("在公共区域内使用，不能相信网络内的其他计算机不会对您的计算机造成危害，只能接收经过选取的连接。")])]),s._v(" "),a("tr",[a("td",[s._v("external")]),s._v(" "),a("td",[s._v("外部")]),s._v(" "),a("td",[s._v("特别是为路由器启用了伪装功能的外部网。您不能信任来自网络的其他计算，不能相信它们不会对您的计算机造成危害，只能接收经过选择的连接。")])]),s._v(" "),a("tr",[a("td",[s._v("dmz")]),s._v(" "),a("td",[s._v("非军事区")]),s._v(" "),a("td",[s._v("用于您的非军事区内的电脑，此区域内可公开访问，可以有限地进入您的内部网络，仅仅接收经过选择的连接。")])]),s._v(" "),a("tr",[a("td",[s._v("work")]),s._v(" "),a("td",[s._v("工作")]),s._v(" "),a("td",[s._v("用于工作区。您可以基本相信网络内的其他电脑不会危害您的电脑。仅仅接收经过选择的连接。")])]),s._v(" "),a("tr",[a("td",[s._v("home")]),s._v(" "),a("td",[s._v("家庭")]),s._v(" "),a("td",[s._v("用于家庭网络。您可以基本信任网络内的其他计算机不会危害您的计算机。仅仅接收经过选择的连接。")])]),s._v(" "),a("tr",[a("td",[s._v("internal")]),s._v(" "),a("td",[s._v("内部")]),s._v(" "),a("td",[s._v("用于内部网络。您可以基本上信任网络内的其他计算机不会威胁您的计算机。仅仅接受经过选择的连接。")])]),s._v(" "),a("tr",[a("td",[s._v("trusted")]),s._v(" "),a("td",[s._v("信任")]),s._v(" "),a("td",[s._v("可接受所有的网络连接。")])])])]),s._v(" "),a("p",[a("code",[s._v("firewalld")]),s._v(" 里的默认区域被设定为公共区域。")]),s._v(" "),a("h3",{attrs:{id:"_1-service"}},[s._v("1. service")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示支持的 zone 列表：")]),s._v("\nfirewall-cmd --get-zones\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有 zone 详情：")]),s._v("\nfirewall-cmd --list-all-zones\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看某一 zone 详情：")]),s._v("\nfirewall-cmd --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --list-all\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看默认 zone：")]),s._v("\nfirewall-cmd --get-default-zone\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示所有 services：")]),s._v("\nfirewall-cmd --get-services\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看某一服务（返回 yes/no）：")]),s._v("\nfirewall-cmd --query-service"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("service name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nfirewall-cmd --query-service"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# no / 80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示当前 service：")]),s._v("\nfirewall-cmd --list-services\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加服务：")]),s._v("\nfirewall-cmd --add-service"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("service name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除服务：")]),s._v("\nfirewall-cmd --remove-service"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("service name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许SSH服务通过：")]),s._v("\nfirewall-cmd --enable "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ssh\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止SSH服务通过：")]),s._v("\nfirewall-cmd --disable "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("service")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ssh\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加服务至 zone：")]),s._v("\nfirewall-cmd --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-service"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("service name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --permanent\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("h3",{attrs:{id:"_2-port"}},[s._v("2. port")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有端口：")]),s._v("\nfirewall-cmd --list-port\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看某个端口：")]),s._v("\nfirewall-cmd --query-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("/tcp\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加某个端口：")]),s._v("\nfirewall-cmd --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("/tcp --permanent  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除某个端口：")]),s._v("\nfirewall-cmd --remove-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("/tcp\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 80 端口的流量转发至 8080：")]),s._v("\nfirewall-cmd --add-forward-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":proto"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp:toport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("   \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"_3-ip"}},[s._v("3. IP")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查是否允许伪装 IP：")]),s._v("\nfirewall-cmd --query-masquerade\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许防火墙伪装 IP：")]),s._v("\nfirewall-cmd --add-masquerade\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止防火墙伪装 IP：")]),s._v("\nfirewall-cmd --remove-masquerade\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 封禁某个 IP：")]),s._v("\nfirewall-cmd --permanent --add-rich-rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rule family=ipv4 source address=\"ip\" drop'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"_4-rich-rule"}},[s._v("4. rich-rule")]),s._v(" "),a("p",[s._v("多规则命令的格式或结构如下（及"),a("a",{attrs:{href:"https://access.redhat.com/documentation/zh_cn/red_hat_enterprise_linux/7/html/security_guide/sec-using_firewalls#Configuring_Complex_Firewall_Rules_with_the_Rich-Language_Syntax",target:"_blank",rel:"noopener noreferrer"}},[s._v("解释"),a("OutboundLink")],1),s._v("）：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("rule "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("family"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<rule family>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("address")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<address>"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("invert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"True"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" destination "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("address")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<address>"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("invert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"True"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("element"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("prefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<prefix text>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("level"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<log level>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("limit "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rate/duration"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" audit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" accept"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("reject"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("drop "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);