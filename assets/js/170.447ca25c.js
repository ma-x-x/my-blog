(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{701:function(s,a,n){"use strict";n.r(a);var e=n(2),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"前言"}},[s._v("前言")]),s._v(" "),n("p",[s._v("一开始选择了 "),n("a",{attrs:{href:"https://www.isc.org/bind/",target:"_blank",rel:"noopener noreferrer"}},[s._v("bind"),n("OutboundLink")],1),s._v("，试用后觉得配置麻烦就选择了更为轻量的 "),n("a",{attrs:{href:"http://www.thekelleys.org.uk/dnsmasq/doc.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("dnsmasq"),n("OutboundLink")],1),s._v("。")]),s._v(" "),n("p",[s._v("该笔记基本参考 "),n("a",{attrs:{href:"https://www.cnblogs.com/pyyu/p/10318334.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("CentOS7 安装 dnsmaqs 局域网 DNS"),n("OutboundLink")],1),s._v("。")]),s._v(" "),n("h2",{attrs:{id:"安装"}},[s._v("安装")]),s._v(" "),n("h3",{attrs:{id:"_1-基本环境"}},[s._v("1. 基本环境")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" bind-utils dnsmasq -y\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_2-备份"}},[s._v("2. 备份")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/dnsmasq.conf /etc/dnsmasq.conf.bak\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_3-配置"}},[s._v("3. 配置")]),s._v(" "),n("p",[s._v("在 "),n("code",[s._v("/etc/dnsmasq.conf")]),s._v(" 中可以看到都是注释项，所以猜测清空所有再增加也可：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示严格按照 resolv-file 文件中的顺序从上到下进行 DNS 解析, 直到第一个成功解析成功为止")]),s._v("\nstrict-order\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定上游dns服务器")]),s._v("\nresolv-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/resolv.dnsmasq.conf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自定义的dns记录文件")]),s._v("\naddn-hosts"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/dnsmasq.hosts\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设为当前服务器")]),s._v("\nlisten-address"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.42\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓存大小")]),s._v("\ncache-size"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意该项是否正确（我在启用时网卡指向了另外一个）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("interface")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eth0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("填写上游 DNS 服务：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/resolv.dnsmasq.conf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写入")]),s._v("\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("223.5")]),s._v(".5.5\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("223.6")]),s._v(".6.6\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("填写自建的 DNS 解析：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/dnsmasq.hosts\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写入")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.144 test.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("将当前主机的 DNS 服务指向 "),n("code",[s._v("dnsmasq")]),s._v("，若重启失效那么需要对 "),n("code",[s._v("NetworkManager")]),s._v(" 进行配置。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/resolv.conf\n\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.42\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("最后重启服务：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查配置正确")]),s._v("\ndnsmasq --test\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启")]),s._v("\nsystemctl restart dnsmasq\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"测试"}},[s._v("测试")]),s._v(" "),n("p",[s._v("切换到其他主机下：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("dig")]),s._v(" @192.168.0.42 test.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("如果测试失败，可以考虑端口是否被防火墙拦截：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("telnet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.42 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);